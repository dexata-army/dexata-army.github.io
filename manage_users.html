<!DOCTYPE HTML>
<html>
	<head>
		<title>Dexata - manage users</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/pagestyle.css" />
		<link rel="stylesheet" href="assets/css/print.css" />
		<link rel="icon" type="image/svg" href="images/logo.png">
		
		<!-- Scripts -->
		<script src="assets/js/params.js"></script>
		<script src="assets/js/sleep.js"></script>
		<script src="assets/js/wallet.js"></script>
		<script src="assets/js/watchlist.js"></script>
		<script src="assets/js/apex-charts/apexcharts.min.js"></script>
		<script src="assets/js/crypto-js/crypto-js.js"></script>
		
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.dropotron.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		
		<!-- https://printjs.crabbly.com/ -->
		<script src="assets/js/print.js"></script>
		
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-D70JLR4EJM"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		
		  gtag('config', 'G-D70JLR4EJM');
		</script>

		<script>
			var user = "guest";
		
			if(localStorage.getItem('username'))
				user = localStorage.getItem('username');
			else if(sessionStorage.getItem('username'))
				user = sessionStorage.getItem('username');
		
			//alert(user);
		
			function logout()
			{
				//alert("logged out debug message");
				localStorage.removeItem('no_dexata_tabs');
				localStorage.removeItem('last_load_time');
				localStorage.removeItem('last_seen');
				localStorage.removeItem('username');
				sessionStorage.removeItem('username');
				localStorage.removeItem('password');
				sessionStorage.removeItem('password');
				//location.reload();
			}
		
			function check_for_logout(username)
			{
				sleep(2000).then(() => { 
					if((!sessionStorate.getItem('username') && !localStorage.getItem('username')) || 
						(sessionStorage.getItem('username') != username && localStorage.getItem('username') != username))
						location.reload();
					else
						check_for_logout(username);
				});
			}
		
			function update_last_seen()
			{
				localStorage.setItem('last_seen', Math.round((new Date()).getTime() / 1000));
				sleep(2000).then(() => {
					update_last_seen();
				});
			}
		
			var session_timeout_sec = localStorage.getItem(user + '-session_timeout')*60;
		
			if(session_timeout_sec != undefined && session_timeout_sec > 0)
			{
				if(sessionStorage.getItem('username') || localStorage.getItem('username'))
				{
					var curr_time = Math.round((new Date()).getTime() / 1000);
		
					//checks last page load time
					if(localStorage.getItem("last_load_time"))
					{
						if(curr_time - localStorage.getItem("last_load_time") > session_timeout_sec)
						{
							logout();
							location.reload();
						}
						else
							localStorage.setItem("last_load_time", curr_time);
					}
					else
					{
						logout();
						location.reload();
					}
				}
			}
		
			if(sessionStorage.getItem("username") && !localStorage.getItem("username"))
			{
				var curr_time = Math.round((new Date()).getTime() / 1000);
				//alert(curr_time - localStorage.getItem("last_seen"));
				if(!localStorage.getItem("last_seen") ||
				     curr_time - localStorage.getItem("last_seen") > 5)
				{
					//alert(curr_time - localStorage.getItem('last_seen'));
					//logout();
					//location.reload();
				}
				else
				{
					localStorage.setItem("no_dexata_tabs", 0);
					localStorage.setItem("username", sessionStorage.getItem("username"));
					localStorage.setItem("password", sessionStorage.getItem("password"));
				}
			}
			else if(!sessionStorage.getItem("username") && localStorage.getItem("username"))
			{
				sessionStorage.setItem("username", localStorage.getItem("username"));
				sessionStorage.setItem("password", localStorage.getItem("password"));
			}
		
			var load_host = window.location.hostname;
			if(localStorage.getItem("username"))
			{
				//updates number of dexata tabs open
				if(localStorage.getItem('no_dexata_tabs') != undefined &&
					localStorage.getItem('no_dexata_tabs') >= 0)
					localStorage.setItem('no_dexata_tabs', parseFloat(localStorage.getItem('no_dexata_tabs'))+1);
				else
					localStorage.setItem('no_dexata_tabs', 1);
		
				window.addEventListener('beforeunload', function (e) {
					if(localStorage.getItem('no_dexata_tabs'))
					{
					    localStorage.setItem('no_dexata_tabs', parseFloat(localStorage.getItem('no_dexata_tabs'))-1);
		
					    if(localStorage.getItem('no_dexata_tabs') == 0)
					    {
					    	localStorage.removeItem('no_dexata_tabs');
					    	localStorage.removeItem('username');
					    	localStorage.removeItem('password');
					    }
					}
					else
					{
						sessionStorage.removeItem('username');
						sessionStorage.removeItem('password');
					}
				});
		
				//reloads page if user has logged out
				$(document).ready(function(){
					check_for_logout(localStorage.getItem('username'));
				});
			}
		
			window.addEventListener("pageshow", function (event) {
				var historyTraversal = event.persisted || 
				                     ( typeof window.performance != "undefined" && 
				                          window.performance.navigation.type === 2 );
				if(historyTraversal &&
					sessionStorage.getItem('username') &&
					curr_time - localStorage.getItem('last_seen') > 5)
				{
					// Handle page restore.
					window.location.reload();
				}
			});
		
			window.onbeforeunload = function(){
				if(sessionStorage.getItem('username') || localStorage.getItem('username'))
					localStorage.setItem('last_seen', Math.round((new Date()).getTime() / 1000));
			};
		
			//updates last seen every 2 seconds
			$(document).ready(function(){
				update_last_seen();
			});
		</script>
	</head>
	<body class="is-preload">
		<!-- Header -->
		<header id="header" class="alt">
			<div class="logo" style="margin-top: -25px">
				<noselect>
					<a href="index.html"><img src="images/logo.png" height="45px" style="vertical-align: middle"> Dexata</a> &nbsp; 
					<a href="search.html" title='search'><i class="fas fa-search fa-1x" style="vertical-align:middle"></i></a> 
					<a href="config.html" title='config'><i class="fas fa-cogs fa-1x" style="vertical-align:middle"></i></a> 
					<a href="manage_users.html" title='manage users'><i class="fas fa-user-cog fa-1x" style="vertical-align:middle"></i></a> 
				</noselect>
			</div>
		
			<nav id="nav">
				<ul>
					<li><a href="index.html">home</a></li>
					<li><a href="coins.html">coins</a></li>
					<li><a href="charts.html">charts</a></li>
					<li><a href="scams.html">scams</a></li>
					<li><a href="watchlist.html">watchlist</a></li>
					<li><a href="wallet.html">wallet</a></li>
					<li id="login_menu_item"></li>
				</ul>
			</nav>
		</header>

		<!-- Wrapper -->
		<div id="wrapper">
			<!-- One -->
			<section id="one" class="wrapper style1">
				<div class="inner">
					<div class="spotlights">
						<center>
							<div class="spotlight" style="max-width:500px; margin-bottom: 35px">
								<div class="content">
									<h1><i class="fas fa-users-cog fa-4x" style="vertical-align:middle"></i><br><noselect>Manage Users</noselect></h1>
								</div>
							</div>
		
							<select id="add_rem_select" style="max-width: 100%; margin-bottom: 20px;display: inline-block" onchange="add_rem_select_event()">
								<option value="add" selected="selected">add user</option>
								<option value="remove">remove user</option>
								<option value="change_username">change username</option>
								<option value="change_password">change password</option>
								<option value="backup_user">backup user</option>
								<option value="restore_user">restore user</option>
							</select><br>
		
							<div id="add_user_spotlight" class="spotlight" style="max-width:100%; margin-bottom: 0px; display: inline-block">
								<div id="add_user_div" class="xscroll">
									<table id="add_user_table">
										<tr>
											<td><input id="add_user_username" spellcheck="false" placeholder="username"></td>
										</tr>
										<tr>
											<td><input id="add_user_password" spellcheck="false" placeholder="password" type="password"></td>
										</tr>
										<tr>
											<td><input id="confirm_password" spellcheck="false" placeholder="confirm password" type="password"></td>
										</tr>
									</table>
									<a onclick="add_user()"><i class="fas fa-user-plus fa-2x" style="margin-bottom: 10px"></i></a><br>
								</div>
							</div>
							<div id="remove_user_spotlight" class="spotlight" style="max-width:100%; margin-bottom: 0px;display: none">
								<div id="remove_user_div" class="xscroll">
									<table id="remove_user_table">
										<tr>
											<td><input id="remove_user_username" spellcheck="false" placeholder="username"></td>
										</tr>
										<tr>
											<td><input id="remove_user_password" spellcheck="false" placeholder="password" type="password"></td>
										</tr>
									</table>
									<a onclick="remove_user()"><i class="fas fa-user-minus fa-2x" style="margin-bottom: 10px"></i></a><br>
								</div>
							</div>
							<div id="change_password_spotlight" class="spotlight" style="max-width:100%; margin-bottom: 0px; display: none">
								<div id="change_password_div" class="xscroll">
									<table id="change_password_table">
										<tr>
											<td><input id="change_password_username" spellcheck="false" placeholder="username"></td>
										</tr>
										<tr>
											<td><input id="old_password" spellcheck="false" placeholder="old password" type="password"></td>
										</tr>
										<tr>
											<td><input id="new_password" spellcheck="false" placeholder="new password" type="password"></td>
										</tr>
										<tr>
											<td><input id="confirm_new_password" spellcheck="false" placeholder="confirm password" type="password"></td>
										</tr>
									</table>
									<a onclick="change_password()"><i class="fas fa-user-edit fa-2x" style="margin-bottom: 10px"></i></a><br>
								</div>
							</div>
							<div id="change_username_spotlight" class="spotlight" style="max-width:100%; margin-bottom: 0px; display: none">
								<div id="change_username_div" class="xscroll">
									<table id="change_username_table">
										<tr>
											<td><input id="old_username" spellcheck="false" placeholder="old username"></td>
										</tr>
										<tr>
											<td><input id="new_username" spellcheck="false" placeholder="new username"></td>
										</tr>
										<tr>
											<td><input id="change_username_password" spellcheck="false" placeholder="password" type="password"></td>
										</tr>
									</table>
									<a onclick="change_username()"><i class="fas fa-user-edit fa-2x" style="margin-bottom: 10px"></i></a><br>
								</div>
							</div>
							<div id="backup_user_spotlight" class="spotlight" style="max-width:100%; margin-bottom: 0px; display: none">
								<div id="backup_user_div" class="xscroll">
									<table id="backup_user_table">
										<tr>
											<td><input id="backup_username" spellcheck="false" placeholder="username"></td>
										</tr>
										<tr>
											<td><input id="backup_password" spellcheck="false" placeholder="password" type="password"></td>
										</tr>
										<tr>
											<td><input id="backup_passphrase" spellcheck="false" placeholder="passphrase" type="password"></td>
										</tr>
									</table>
									<a onclick="backup_user()"><i class="fas fa-check-circle fa-2x" style="margin-bottom: 10px"></i></a><br>
								</div>
							</div>
							<div id="backup_ta_div" style="display: none; margin-top: 30px">
								<p>
									Save to file
									<textarea id="backup_ta" spellcheck="false" style="max-width:100%; width: 400px; height: 250px; margin-top: 10px; margin-bottom: 10px"></textarea>
								</p>
							</div>
							<div id="restore_user_spotlight" class="spotlight" style="max-width:100%; margin-bottom: 0px; display: none">
								<div id="restore_user_div" class="xscroll">
									<table id="restore_user_table">
										<tr>
											<td><input id="encrypted_data" spellcheck="false" placeholder="encrypted data"></td>
										</tr>
										<tr>
											<td><input id="restore_passphrase" spellcheck="false" placeholder="passphrase" type="password"></td>
										</tr>
										<tr>
											<td><input id="restore_username" spellcheck="false" placeholder="username"></td>
										</tr>
										<tr>
											<td><input id="restore_password" spellcheck="false" placeholder="password" type="password"></td>
										</tr>
										<tr>
											<td><input id="restore_confirm_password" spellcheck="false" placeholder="confirm password" type="password"></td>
										</tr>
									</table>
									<a onclick="restore_user()"><i class="fas fa-check-circle fa-2x" style="margin-bottom: 10px"></i></a><br>
								</div>
							</div>
						</center>
					</div>
				</div>
			</section>
		</div>
		
		<script>
			window.addEventListener('keydown',this.keydown,false);
		
			var widthOffset = document.getElementById('add_user_div').offsetWidth;
		
			function add_rem_select_event()
			{
				document.getElementById('add_user_spotlight').style.display = "none";
				document.getElementById('remove_user_spotlight').style.display = "none";
				document.getElementById('change_username_spotlight').style.display = "none";
				document.getElementById('change_password_spotlight').style.display = "none";
				document.getElementById('backup_user_spotlight').style.display = "none";
				document.getElementById('backup_ta_div').style.display = "none";
				document.getElementById('restore_user_spotlight').style.display = "none";
		
				if(document.getElementById('add_rem_select').value == "add")
				{
					document.getElementById('add_user_spotlight').style.display = "inline-block";
		
					document.getElementById('add_rem_select').style.width = (widthOffset + 70) + "px";
					document.getElementById('add_user_spotlight').style.width = (widthOffset + 70) + "px";
				}
				else if(document.getElementById('add_rem_select').value == "remove")
				{
					document.getElementById('remove_user_spotlight').style.display = "inline-block";
		
					document.getElementById('add_rem_select').style.width = (widthOffset + 70) + "px";
					document.getElementById('remove_user_spotlight').style.width = (widthOffset + 70) + "px";
				}
				else if(document.getElementById('add_rem_select').value == "change_username")
				{
					document.getElementById('change_username_spotlight').style.display = "inline-block";
		
					document.getElementById('add_rem_select').style.width = (widthOffset + 70) + "px";
					document.getElementById('change_username_spotlight').style.width = (widthOffset + 70) + "px";
				}
				else if(document.getElementById('add_rem_select').value == "change_password")
				{
					document.getElementById('change_password_spotlight').style.display = "inline-block";
		
					document.getElementById('add_rem_select').style.width = (widthOffset + 70) + "px";
					document.getElementById('change_password_spotlight').style.width = (widthOffset + 70) + "px";
				}
				else if(document.getElementById('add_rem_select').value == "backup_user")
				{
					document.getElementById('backup_user_spotlight').style.display = "inline-block";
		
					document.getElementById('add_rem_select').style.width = (widthOffset + 70) + "px";
					document.getElementById('backup_user_spotlight').style.width = (widthOffset + 70) + "px";
				}
				else if(document.getElementById('add_rem_select').value == "restore_user")
				{
					document.getElementById('restore_user_spotlight').style.display = "inline-block";
		
					document.getElementById('add_rem_select').style.width = (widthOffset + 70) + "px";
					document.getElementById('restore_user_spotlight').style.width = (widthOffset + 70) + "px";
				}
			}
		
			function add_user()
			{
				if(document.getElementById('add_user_username').value == "")
					alert("no username specified");
				else if(document.getElementById('add_user_username').value == "guest")
					alert("cannot have username as guest");
				else if(document.getElementById('add_user_password').value.length < 5)
					alert("password must be at least 5 characters long");
				else if(localStorage.getItem(document.getElementById('add_user_username').value + '-encrypted_phrase'))
				{
					alert("account already exists for " + document.getElementById('add_user_username').value);
				}
				else if(document.getElementById('add_user_password').value == document.getElementById('confirm_password').value)
				{
					localStorage.setItem(document.getElementById('add_user_username').value + '-encrypted_phrase', CryptoJS.AES.encrypt("Go hang a salami, I’m a lasagna hog.", document.getElementById('add_user_password').value));
		
					alert("successfully added " + document.getElementById('add_user_username').value);
		
					location.reload();	
				}
				else
				{
					document.getElementById('add_user_password').value = document.getElementById('confirm_password').value = "";
					alert("passwords do not match");
				}
			}
		
			function remove_user()
			{
				if(localStorage.getItem(document.getElementById('remove_user_username').value + '-encrypted_phrase') &&
					CryptoJS.AES.decrypt(localStorage.getItem(document.getElementById('remove_user_username').value + '-encrypted_phrase'), document.getElementById('remove_user_password').value).toString(CryptoJS.enc.Utf8) == "Go hang a salami, I’m a lasagna hog.")
				{
					var remove_username = document.getElementById('remove_user_username').value;
		
					document.getElementById('remove_user_username').value = "";
					document.getElementById('remove_user_password').value = "";
		
					var rem_user = confirm("are you sure you would like to remove user " + remove_username + "?");
		
					if(rem_user)
					{
						localStorage.removeItem(remove_username + '-encrypted_phrase');
						localStorage.removeItem(remove_username + '-refresh_speed');
						localStorage.removeItem(remove_username + '-session_timeout');
						localStorage.removeItem(remove_username + '-bscscan_api_key');
						localStorage.removeItem(remove_username + '-covalenthq_api_key');
		
						localStorage.removeItem(remove_username + '-chart_freq');
						localStorage.removeItem(remove_username + '-chart_range');
		
						var watchlists = fetch_watchlists(user);
						for(var i=0; i<watchlists.length; i++)
							localStorage.removeItem(user + '-watchlist-' + watchlists[i]);
						localStorage.removeItem(remove_username + '-watchlist');
						localStorage.removeItem(remove_username + '-watchlists');
		
						var wallets = fetch_wallets(user);
						for(var i=0; i<wallets.length; i++)
						{
							localStorage.removeItem(user + '-wallet-' + wallets[i] + '-network');
							localStorage.removeItem(user + '-wallet-' + wallets[i] + '-address');
							localStorage.removeItem(user + '-ignorelist-' + wallets[i]);
						}
						localStorage.removeItem(remove_username + '-wallet');
						localStorage.removeItem(remove_username + '-wallets');
		
						alert("successfully removed " + remove_username);
		
						if(localStorage.getItem('username') &&
						   localStorage.getItem('username') == remove_username)
							logout();
						location.reload();
					}
		
					return rem_user;
				}
				else
				{
					document.getElementById('remove_user_password').value = "";
					alert("username and password combination do not match any on this system");
					return false;
				}
			}
		
			function change_password()
			{
				var change_password_username = document.getElementById('change_password_username').value;
		
				if(localStorage.getItem(change_password_username + '-encrypted_phrase') &&
					CryptoJS.AES.decrypt(localStorage.getItem(change_password_username + '-encrypted_phrase'), document.getElementById('old_password').value).toString(CryptoJS.enc.Utf8) == "Go hang a salami, I’m a lasagna hog.")
				{
					if(document.getElementById('new_password').value != document.getElementById('confirm_new_password').value)
					{
						document.getElementById('old_password').value = document.getElementById('new_password').value = "";
						alert("passwords do not match");
					}
					else
					{
						var old_password = document.getElementById('old_password').value;
						var new_password = document.getElementById('new_password').value;
		
						localStorage.removeItem(change_password_username + '-encrypted_phrase');
						localStorage.setItem(change_password_username + '-encrypted_phrase', CryptoJS.AES.encrypt("Go hang a salami, I’m a lasagna hog.", new_password));
		
						if(localStorage.getItem(change_password_username + '-bscscan_api_key'))
							localStorage.setItem(change_password_username + '-bscscan_api_key', CryptoJS.AES.encrypt(CryptoJS.AES.decrypt(localStorage.getItem(change_password_username + '-bscscan_api_key'), old_password).toString(CryptoJS.enc.Utf8), new_password));
		
						if(localStorage.getItem(change_password_username + '-covalenthq_api_key'))
							localStorage.setItem(change_password_username + '-covalenthq_api_key', CryptoJS.AES.encrypt(CryptoJS.AES.decrypt(localStorage.getItem(change_password_username + '-covalenthq_api_key'), old_password).toString(CryptoJS.enc.Utf8), new_password));
		
						var wallets = fetch_wallets();
						for(var i=0; i<wallets.length; i++)
							if(localStorage.getItem(change_password_username + '-wallets-' + wallets[i] + '-address'))
								localStorage.setItem(change_password_username + '-wallets-' + wallets[i] + '-address', CryptoJS.AES.encrypt(CryptoJS.AES.decrypt(localStorage.getItem(change_password_username + '-wallets-' + wallets[i] + '-address'), old_password).toString(CryptoJS.enc.Utf8), new_password));
		
						old_password = new_password = "";
		
						alert("successfully changed the password for " + change_password_username);
		
						if(localStorage.getItem('username') &&
						   localStorage.getItem('username') == change_password_username)
							logout();
						location.reload();
					}
				}
				else
				{
					document.getElementById('old_password').value = document.getElementById('new_password').value = "";
					alert("username and password combination do not match any on this system");
				}
			}
		
			function change_username()
			{
				if(localStorage.getItem(document.getElementById('new_username').value == ""))
				{
					document.getElementById('change_username_password').value = "";
					alert("no new username specified");
				}
				else if(localStorage.getItem(document.getElementById('new_username').value == "guest"))
				{
					document.getElementById('new_username').value = "";
					document.getElementById('change_username_password').value = "";
					alert("cannot have username as guest");
				}
				else if(localStorage.getItem(document.getElementById('new_username').value + '-encrypted_phrase'))
				{
					document.getElementById('new_username').value = "";
					document.getElementById('change_username_password').value = "";
					alert("there is already a user called " + document.getElementById('new_username').value);
				}
				else if(localStorage.getItem(document.getElementById('old_username').value + '-encrypted_phrase') &&
					CryptoJS.AES.decrypt(localStorage.getItem(document.getElementById('old_username').value + '-encrypted_phrase'), document.getElementById('change_username_password').value).toString(CryptoJS.enc.Utf8) == "Go hang a salami, I’m a lasagna hog.")
				{
					var old_username = document.getElementById('old_username').value;
					var new_username = document.getElementById('new_username').value;
		
					document.getElementById('old_username').value = "";
					document.getElementById('new_username').value = "";
					document.getElementById('change_username_password').value = "";
		
					if(localStorage.getItem(old_username + '-encrypted_phrase'))
					{
						localStorage.setItem(new_username + '-encrypted_phrase', localStorage.getItem(old_username + '-encrypted_phrase'));
						localStorage.removeItem(old_username + '-encrypted_phrase');
					}
		
					if(localStorage.getItem(old_username + '-refresh_speed'))
					{
						localStorage.setItem(new_username + '-refresh_speed', localStorage.getItem(old_username + '-refresh_speed'));
						localStorage.removeItem(old_username + '-refresh_speed');
					}
		
					if(localStorage.getItem(old_username + '-session_timeout'))
					{
						localStorage.setItem(new_username + '-session_timeout', localStorage.getItem(old_username + '-session_timeout'));
						localStorage.removeItem(old_username + '-session_timeout');
					}
		
					if(localStorage.getItem(old_username + '-bscscan_api_key'))
					{
						localStorage.setItem(new_username + '-bscscan_api_key', localStorage.getItem(old_username + '-bscscan_api_key'));
						localStorage.removeItem(old_username + '-bscscan_api_key');
					}
		
					if(localStorage.getItem(old_username + '-covalenthq_api_key'))
					{
						localStorage.setItem(new_username + '-covalenthq_api_key', localStorage.getItem(old_username + '-covalenthq_api_key'));
						localStorage.removeItem(old_username + '-covalenthq_api_key');
					}
		
					if(localStorage.getItem(old_username + '-chart_freq'))
					{
						localStorage.setItem(new_username + '-chart_freq', localStorage.getItem(old_username + '-chart_freq'));
						localStorage.removeItem(old_username + '-chart_freq');
					}
		
					if(localStorage.getItem(old_username + '-chart_range'))
					{
						localStorage.setItem(new_username + '-chart_range', localStorage.getItem(old_username + '-chart_range'));
						localStorage.removeItem(old_username + '-chart_range');
					}
		
		
					var watchlists = fetch_watchlists(old_username);
					for(var i=0; i<watchlists.length; i++)
					{
						if(localStorage.getItem(old_username + '-watchlist-' + watchlists[i]))
						{
							localStorage.setItem(new_username + '-watchlist-' + watchlists[i], localStorage.getItem(old_username + '-watchlist-' + watchlists[i]));
							localStorage.removeItem(old_username + '-watchlist-' + watchlists[i]);
						}
					}
		
					if(localStorage.getItem(old_username + '-watchlist'))
					{
						localStorage.setItem(new_username + '-watchlist', localStorage.getItem(old_username + '-watchlist'));
						localStorage.removeItem(old_username + '-watchlist');
					}
		
					if(localStorage.getItem(old_username + '-watchlists'))
					{
						localStorage.setItem(new_username + '-watchlists', localStorage.getItem(old_username + '-watchlists'));
						localStorage.removeItem(old_username + '-watchlists');
					}
		
					var wallets = fetch_wallets(old_username);
					for(var i=0; i<wallets.length; i++)
					{
						if(localStorage.getItem(old_username + '-wallets-' + wallets[i] + '-network'))
						{
							localStorage.setItem(new_username + '-wallets-' + wallets[i] + '-network', localStorage.getItem(old_username + '-wallets-' + wallets[i] + '-network'));
							localStorage.removeItem(old_username + '-wallets-' + wallets[i] + '-network');
						}
		
						if(localStorage.getItem(old_username + '-wallets-' + wallets[i] + '-address'))
						{
							localStorage.setItem(new_username + '-wallets-' + wallets[i] + '-address', localStorage.getItem(old_username + '-wallets-' + wallets[i] + '-address'));
							localStorage.removeItem(old_username + '-wallets-' + wallets[i] + '-address');
						}
		
						if(localStorage.getItem(old_username + '-ignorelist-' + wallets[i]))
						{
							localStorage.setItem(new_username + '-ignorelist-' + wallets[i], localStorage.getItem(old_username + '-ignorelist-' + wallets[i]));
							localStorage.removeItem(old_username + '-ignorelist-' + wallets[i]);
						}
					}
		
					if(localStorage.getItem(old_username + '-wallet'))
					{
						localStorage.setItem(new_username + '-wallet', localStorage.getItem(old_username + '-wallet'));
						localStorage.removeItem(old_username + '-wallet');
					}
		
					if(localStorage.getItem(old_username + '-wallets'))
					{
						localStorage.setItem(new_username + '-wallets', localStorage.getItem(old_username + '-wallets'));
						localStorage.removeItem(old_username + '-wallets');
					}
		
					if(localStorage.getItem("username") == old_username)
						localStorage.setItem("username", new_username);
		
					if(sessionStorage.getItem("username") == old_username)
						sessionStorage.setItem("username", new_username);
		
					alert("username changed from " + old_username + " to " + new_username);
		
					location.reload();
				}
				else
				{
					document.getElementById('change_username_password').value = "";
					alert("username and password combination do not match any on this system");
				}
			}
		
			function backup_user()
			{
				if(localStorage.getItem(document.getElementById('backup_username').value + '-encrypted_phrase') &&
					CryptoJS.AES.decrypt(localStorage.getItem(document.getElementById('backup_username').value + '-encrypted_phrase'), document.getElementById('backup_password').value).toString(CryptoJS.enc.Utf8) == "Go hang a salami, I’m a lasagna hog.")
				{
					var backup_username = document.getElementById('backup_username').value;
		
					var user_data = {};
		
					if(localStorage.getItem(backup_username + '-refresh_speed'))
						user_data['-refresh_speed'] = localStorage.getItem(backup_username + '-refresh_speed');
		
					if(localStorage.getItem(backup_username + '-session_timeout'))
						user_data['-session_timeout'] = localStorage.getItem(backup_username + '-session_timeout');
		
					if(localStorage.getItem(backup_username + '-bscscan_api_key'))
						user_data['-bscscan_api_key'] = CryptoJS.AES.decrypt(localStorage.getItem(backup_username + '-bscscan_api_key'), document.getElementById('backup_password').value).toString(CryptoJS.enc.Utf8);
		
					if(localStorage.getItem(backup_username + '-covalenthq_api_key'))
						user_data['-covalenthq_api_key'] = CryptoJS.AES.decrypt(localStorage.getItem(backup_username + '-covalenthq_api_key'), document.getElementById('backup_password').value).toString(CryptoJS.enc.Utf8);
		
					if(localStorage.getItem(backup_username + '-chart_freq'))
						user_data['-chart_freq'] = localStorage.getItem(backup_username + '-chart_freq');
		
					if(localStorage.getItem(backup_username + '-chart_range'))
						user_data['-chart_range'] = localStorage.getItem(backup_username + '-chart_range');
		
					if(localStorage.getItem(backup_username + '-watchlist'))
						user_data['-watchlist'] = localStorage.getItem(backup_username + '-watchlist');
		
					if(localStorage.getItem(backup_username + '-watchlists'))
						user_data['-watchlists'] = localStorage.getItem(backup_username + '-watchlists');
		
					var watchlists = fetch_watchlists(backup_username);
					for(var i=1; i<watchlists.length; i++)
						if(localStorage.getItem(backup_username + '-watchlist-' + watchlists[i]))
							user_data['-watchlist-' + watchlists[i]] = localStorage.getItem(backup_username + '-watchlist-' + watchlists[i]);
		
					if(localStorage.getItem(backup_username + '-wallet'))
						user_data['-wallet'] = localStorage.getItem(backup_username + '-wallet');
		
					if(localStorage.getItem(backup_username + '-wallets'))
						user_data['-wallets'] = localStorage.getItem(backup_username + '-wallets');
		
					var wallets = fetch_wallets(backup_username);
					for(var i=1; i<wallets.length; i++)
					{
						if(localStorage.getItem(backup_username + '-wallets-' + wallets[i] + "-network"))
							user_data['-wallets-' + wallets[i] + '-network'] = localStorage.getItem(backup_username + '-wallets-' + wallets[i] + '-network');
		
						if(localStorage.getItem(backup_username + '-wallets-' + wallets[i] + "-address"))
							user_data['-wallets-' + wallets[i] + '-address'] = CryptoJS.AES.decrypt(localStorage.getItem(backup_username + '-wallets-' + wallets[i] + '-address'), document.getElementById('backup_password').value).toString(CryptoJS.enc.Utf8);
		
						if(localStorage.getItem(backup_username + '-ignorelist-' + wallets[i]))
							user_data['-ignorelist-' + wallets[i]] = localStorage.getItem(backup_username + '-ignorelist-' + wallets[i]);
					}
		
					document.getElementById('backup_ta_div').style.display = "block";
					var user_data_str = JSON.stringify(user_data);
					document.getElementById('backup_ta').value = CryptoJS.AES.encrypt(user_data_str, document.getElementById('backup_passphrase').value);
				}
		
				document.getElementById('backup_password').value = "";
				document.getElementById('backup_passphrase').value = "";
			}
		
			function restore_user()
			{
				if(document.getElementById('restore_username').value == "")
					alert("no username specified");
				else if(document.getElementById('restore_username').value == "guest")
					alert("cannot have username as guest");
				else if(document.getElementById('restore_password').value.length < 5)
					alert("password must be at least 5 characters long");
				else if(document.getElementById('restore_password').value == document.getElementById('restore_confirm_password').value)
				{
					var decrypted_data;
		
					try
					{
						decrypted_data = JSON.parse(CryptoJS.AES.decrypt(document.getElementById('encrypted_data').value, document.getElementById('restore_passphrase').value).toString(CryptoJS.enc.Utf8));
					} catch(e)
					{
						alert("passphrase provided is incorrect");
					}
		
					var restore_username = document.getElementById('restore_username').value;
					var restore_password = document.getElementById('restore_password').value;
		
					if(localStorage.getItem(restore_username + '-encrypted_phrase') &&
						CryptoJS.AES.decrypt(localStorage.getItem(restore_username + '-encrypted_phrase'), restore_password).toString(CryptoJS.enc.Utf8) == "Go hang a salami, I’m a lasagna hog.")
					{
						document.getElementById('remove_user_username').value = restore_username;
						document.getElementById('remove_user_password').value = restore_password;
		
						if(!remove_user())
						{
							document.getElementById('restore_passphrase').value = "";
							document.getElementById('restore_password').value = "";
							document.getElementById('restore_confirm_password').value = "";
							return;
						}
					}
		
					for(let i in decrypted_data)
					{
						localStorage.setItem(restore_username + '-encrypted_phrase', CryptoJS.AES.encrypt("Go hang a salami, I’m a lasagna hog.", restore_password));
		
						if(i == "-bscscan_api_key")
							localStorage.setItem(restore_username + '-bscscan_api_key', CryptoJS.AES.encrypt(decrypted_data[i], restore_password));
						else if(i == "-covalenthq_api_key")
							localStorage.setItem(restore_username + '-covalenthq_api_key', CryptoJS.AES.encrypt(decrypted_data[i], restore_password));
						else if(i.substring(i.length-8) == "-address")
							localStorage.setItem(restore_username + i, CryptoJS.AES.encrypt(decrypted_data[i], restore_password));
						else
							localStorage.setItem(restore_username +  i, decrypted_data[i]);
					}
		
					alert("successfully restored data to username " + restore_username);
				}
				else
					alert("passwords do not match");
		
				document.getElementById('restore_passphrase').value = "";
				document.getElementById('restore_password').value = "";
				document.getElementById('restore_confirm_password').value = "";
			}
		
			function keydown(e)
			{
				var code = e.keyCode;
				
				if(code == 13)
				{
					if(document.activeElement.id == "confirm_password")
						add_user();
					else if(document.activeElement.id == "remove_user_password")
						remove_user();
					else if(document.activeElement.id == "change_username_password")
						change_username();
					else if(document.activeElement.id == "confirm_new_password")
						change_password();
					else if(document.activeElement.id == "backup_passphrase")
						backup_user();
					else if(document.activeElement.id == "restore_confirm_password")
						restore_user();
				}
			}
		
			document.getElementById('add_rem_select').style.width = (document.getElementById('add_user_div').offsetWidth + 70) + "px";
			document.getElementById('add_user_spotlight').style.width = (document.getElementById('add_user_div').offsetWidth + 70) + "px";
			document.getElementById('change_username_spotlight').style.width = (document.getElementById('add_user_div').offsetWidth + 70) + "px";
			document.getElementById('change_password_spotlight').style.width = (document.getElementById('add_user_div').offsetWidth + 70) + "px";
			document.getElementById('backup_user_spotlight').style.width = (document.getElementById('add_user_div').offsetWidth + 70) + "px";
			document.getElementById('restore_user_spotlight').style.width = (document.getElementById('add_user_div').offsetWidth + 70) + "px";
		
		</script>

		<!-- Footer -->
		<div class="footer wrapper">
			<div class="inner" style="text-align:center">
				<noselect>
					<p>
						<a href="search.html" title='search'><i class="fas fa-search fa-2x"></i></a> &nbsp;
						<a href="coins.html" title='coins'><i class="fas fa-coins fa-2x"></i></a> &nbsp;
						<a href="charts.html" title='charts'><i class="fas fa-chart-area fa-2x"></i></a> &nbsp;
						<a href="scams.html" title='scams'><i class="fas fa-bomb fa-2x"></i></a> &nbsp;
						<a href="watchlist.html" title='watchlist'><i class="fas fa-binoculars fa-2x"></i></a> &nbsp;
						<a href="wallet.html" title='wallet tracker'><i class="fas fa-wallet fa-2x"></i></a><br>
						
						<a href="https://t.me/dexata_army" title='telegram'><i class="icon brands fa-telegram fa-2x"></i></a> &nbsp;
						<a href="https://twitter.com/dexata_army" title='twitter'><i class="icon brands fa-twitter fa-2x"></i></a> &nbsp;
						<a href="https://github.com/dexata-army" title='github'><i class="icon brands fa-github fa-2x"></i></a> &nbsp;
						<a href="config.html" title='config'><i class="fas fa-cogs fa-2x"></i></a> &nbsp;
						<a href="manage_users.html" title='manage users'><i class="fas fa-user-cog fa-2x"></i></a> &nbsp;
						<text id="login_footer_item" style="display: inline-block"><a href="login.html" title='login'><i class="fas fa-sign-in-alt fa-2x"></i></a></text>
					</p>
		
					<p>
						<input id="footer_search_box" placeholder="search">
					</p>
		
					<p class="copyright">
						&copy;<script>document.write(new Date().getFullYear())</script> Dexata
					</p>
				</noselect>
			</div>
		</div>
		
		<script>
			window.addEventListener('keydown',this.keydown,false);
		
			function keydown(e)
			{
				var code = e.keyCode;
				
				if(document.activeElement.tagName == "INPUT")
				{
					if(code == 13)
					{
						if(document.activeElement.id == "footer_search_box" &&
							document.getElementById('footer_search_box').value != "")
						{
							window.location.href = "search.html?term=" + document.getElementById('footer_search_box').value;
						}
					}
				}
			}
		</script>

		<script>
			//changes login to logout on page if logged in
			if(localStorage.getItem("username"))
			{
				//document.getElementById('login_menu_item').innerHTML = "<a onclick='logout()'>logout</a>";
				//document.getElementById('login_footer_item').innerHTML = "<a onclick='logout()' title='logout'><i class='fas fa-sign-out-alt fa-2x'></i></a>";
				document.getElementById('login_menu_item').innerHTML = "<a href='logout.html?return_to=" + window.location.href.substring(window.location.href.lastIndexOf('/') + 1) + "'>logout</a>"
				document.getElementById('login_footer_item').innerHTML = "<a href='logout.html?return_to=" + window.location.href.substring(window.location.href.lastIndexOf('/') + 1) + "'><i class='fas fa-sign-out-alt fa-2x'></i></a>"
			}
			else
			{
				document.getElementById('login_menu_item').innerHTML = "<a href='login.html?return_to=" + window.location.href.substring(window.location.href.lastIndexOf('/') + 1) + "'>login</a>"
				document.getElementById('login_footer_item').innerHTML = "<a href='login.html?return_to=" + window.location.href.substring(window.location.href.lastIndexOf('/') + 1) + "'><i class='fas fa-sign-in-alt fa-2x'></i></a>"
			}
		
			//prevent autocomplete
			$(':input').on('focus', function () {
				$(this).attr('autocomplete', 'off')
			});
		</script>

		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>
	</body>
</html>

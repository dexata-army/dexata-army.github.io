<!DOCTYPE HTML>
<html>
	<head>
		<title>Dexata - wallet</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/pagestyle.css" />
		<link rel="stylesheet" href="assets/css/print.css" />
		<link rel="icon" type="image/svg" href="images/logo.png">
		
		<!-- Scripts -->
		<script src="assets/js/params.js"></script>
		<script src="assets/js/sleep.js"></script>
		<script src="assets/js/wallet.js"></script>
		<script src="assets/js/watchlist.js"></script>
		<script src="assets/js/apex-charts/apexcharts.min.js"></script>
		<script src="assets/js/crypto-js/crypto-js.js"></script>
		
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.dropotron.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		
		<!-- https://printjs.crabbly.com/ -->
		<script src="assets/js/print.js"></script>
		
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-D70JLR4EJM"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());
		
		  gtag('config', 'G-D70JLR4EJM');
		</script>

		<script>
			var user = "guest";
		
			if(localStorage.getItem('username'))
				user = localStorage.getItem('username');
			else if(sessionStorage.getItem('username'))
				user = sessionStorage.getItem('username');
		
			function logout()
			{
				localStorage.removeItem('no_dexata_tabs');
				localStorage.removeItem('last_load_time');
				localStorage.removeItem('last_seen');
				localStorage.removeItem('username');
				sessionStorage.removeItem('username');
				localStorage.removeItem('password');
				sessionStorage.removeItem('password');
				//location.reload();
			}
		
			function check_for_logout(username)
			{
				sleep(2000).then(() => { 
					if(!localStorage.getItem('username') || 
						localStorage.getItem('username') != username)
						location.reload();
					else
						check_for_logout(username);
				});
			}
		
			var session_timeout_sec = localStorage.getItem(user + '-session_timeout')*60;
		
			if(session_timeout_sec != undefined && session_timeout_sec > 0)
			{
				if(sessionStorage.getItem('username') || localStorage.getItem('username'))
				{
					var curr_time = Math.round((new Date()).getTime() / 1000);
		
					//checks last page load time
					if(localStorage.getItem("last_load_time"))
					{
						if(curr_time - localStorage.getItem("last_load_time") > session_timeout_sec)
						{
							logout();
							location.reload();
						}
						else
							localStorage.setItem("last_load_time", curr_time);
					}
					else
					{
						logout();
						location.reload();
					}
				}
			}
		
			if(sessionStorage.getItem("username") && !localStorage.getItem("username"))
			{
				var curr_time = Math.round((new Date()).getTime() / 1000);
				//alert(curr_time - localStorage.getItem("last_seen"));
				if(!localStorage.getItem("last_seen") ||
				     curr_time - localStorage.getItem("last_seen") > 2)
				{
					logout();
					location.reload();
				}
				else
				{
					localStorage.setItem("no_dexata_tabs", 0);
					localStorage.setItem("username", sessionStorage.getItem("username"));
					localStorage.setItem("password", sessionStorage.getItem("password"));
				}
			}
			else if(!sessionStorage.getItem("username") && localStorage.getItem("username"))
			{
				sessionStorage.setItem("username", localStorage.getItem("username"));
				sessionStorage.setItem("password", localStorage.getItem("password"));
			}
		
			var load_host = window.location.hostname;
			if(localStorage.getItem("username"))
			{
				//updates number of dexata tabs open
				if(localStorage.getItem('no_dexata_tabs') != undefined &&
					localStorage.getItem('no_dexata_tabs') >= 0)
					localStorage.setItem('no_dexata_tabs', parseFloat(localStorage.getItem('no_dexata_tabs'))+1);
				else
					localStorage.setItem('no_dexata_tabs', 1);
		
				window.addEventListener('beforeunload', function (e) {
					if(localStorage.getItem('no_dexata_tabs'))
					{
					    localStorage.setItem('no_dexata_tabs', parseFloat(localStorage.getItem('no_dexata_tabs'))-1);
		
					    if(localStorage.getItem('no_dexata_tabs') == 0)
					    {
					    	localStorage.removeItem('no_dexata_tabs');
					    	localStorage.removeItem('username');
					    	localStorage.removeItem('password');
					    }
					}
					else
					{
						sessionStorage.removeItem('username');
						sessionStorage.removeItem('password');
					}
				});
		
				//reloads page if user has logged out
				$(document).ready(function(){
					check_for_logout(localStorage.getItem('username'));
				});
			}
		
			window.addEventListener("pageshow", function (event) {
				var historyTraversal = event.persisted || 
				                     ( typeof window.performance != "undefined" && 
				                          window.performance.navigation.type === 2 );
				if(historyTraversal &&
					sessionStorage.getItem('username') &&
					curr_time - localStorage.getItem('last_seen') > 2)
				{
					alert(curr_time - localStorage.getItem('last_seen') > 2);
					// Handle page restore.
					window.location.reload();
				}
			});
		
			window.onbeforeunload = function(){
				if(sessionStorage.getItem('username') || localStorage.getItem('username'))
						localStorage.setItem('last_seen', Math.round((new Date()).getTime() / 1000));
			};
		</script>
	</head>
	<body class="is-preload">
		<!-- Header -->
		<header id="header" class="alt">
			<div class="logo" style="margin-top: -25px">
				<noselect>
					<a href="index.html"><img src="images/logo.png" height="45px" style="vertical-align: middle"> Dexata</a> &nbsp; 
					<a href="search.html" title='search'><i class="fas fa-search fa-1x" style="vertical-align:middle"></i></a> 
					<a href="config.html" title='config'><i class="fas fa-cogs fa-1x" style="vertical-align:middle"></i></a> 
					<a href="manage_users.html" title='manage users'><i class="fas fa-user-cog fa-1x" style="vertical-align:middle"></i></a> 
				</noselect>
			</div>
		
			<nav id="nav">
				<ul>
					<li><a href="index.html">home</a></li>
					<li><a href="coins.html">coins</a></li>
					<li><a href="charts.html">charts</a></li>
					<li><a href="scams.html">scams</a></li>
					<li><a href="watchlist.html">watchlist</a></li>
					<li><a href="wallet.html">wallet</a></li>
					<li id="login_menu_item"></li>
				</ul>
			</nav>
		</header>

		<!-- Wrapper -->
		<div id="wrapper">	
			<!-- One -->
			<section id="one" class="wrapper style1">
				<div class="inner">
					<div class="spotlights">
						<center>
							<div class="spotlight" style="max-width:500px; margin-bottom: 50px">
								<div class="content">
									<h1><i class="fas fa-wallet fa-4x" style="vertical-align:middle"></i><br><noselect>Wallet</noselect></h1>
								</div>
							</div>
		
							<select id="wallet_select" onchange="wallet_select_event()" style="max-width: 100%; width: 300px; margin-bottom: 20px"></select>
		
							<div id="no_wallets_spotlight" class="spotlight" style="max-width: 100%; width: 400px; display: none; padding-top: 20px; padding-bottom: 20px">
							</div>
		
							<div style="margin-bottom: 10px; margin-top: -10px ;max-width: 40px">
								<a id="charts_link" style="display: none" title="charts"><i class="fas fa-chart-area fa-2x" style="vertical-align: middle"></i></a>
							</div>
		
							<div id="balance_spotlight" class="spotlight" style="max-width:300px;">
								<div id="balance_div" class="xscroll" style="margin-top:10px">
									<b>balance: </b>
								</div>
							</div>
		
							<div class="spotlight" id="table_spotlight" style="max-width: 100%">
								<div id="table_div" class="xscroll">
									<img id="loading_gif" src="images/loading.gif" style="margin-top: 20px; max-width: 150px">
									<table id="wallet_table" style="display: none;">
										<thead>
											<tr>
												<th></th>
												<th><a onclick="toggle_sort('contract_ticker_symbol')">symbol</a></th>
												<th><a onclick="toggle_sort('contract_name')">name</a></th>
												<th><a onclick="toggle_sort('quote_rate')">price</a></th>
												<th><a onclick="toggle_sort('balance')">quantity</a></th>
												<th><a onclick="toggle_sort('quote')">value</a></th>
												<th><a onclick="toggle_hide_coins()"><i class='fas fa-minus-circle fa-1x' style='vertical-align:middle'></i></a></th>
											</tr>
										</thead>
										<tfoot>
											<tr>
												<th></th>
												<th><a onclick="toggle_sort('contract_ticker_symbol')">symbol</a></th>
												<th><a onclick="toggle_sort('contract_name')">name</a></th>
												<th><a onclick="toggle_sort('quote_rate')">price</a></th>
												<th><a onclick="toggle_sort('balance')">quantity</a></th>
												<th><a onclick="toggle_sort('quote')">value</a></th>
												<th><a onclick="toggle_hide_coins()"><i class='fas fa-minus-circle fa-1x' style='vertical-align:middle'></i></a></th>
											</tr>
										</tfoot>
									</table>
								</div>
							</div>
							<a id="show_ignored_coins_button" onclick="toggle_show_ignored_coins()">show ignored coins</a><br><br>
		
							<div id="balance_chart_div" style="display: none">
								<h3>Balance Chart</h3>
								<select id="chart_select" placeholder="" onchange="fetch_chart()" style="max-width: 100%; width: 300px; margin-bottom: 20px;">
									<option disabled selected hidden>coin</option>
								</select>
								<div id="balance_chart_spotlight" class="spotlight" style="width: 100%; display: none; overflow: hidden">
									<div id="balance_chart" style="width: 100%; height: 100%; padding-left: 10px; padding-right: 10px;padding-top: 10px; padding-bottom: 10px; margin: 0 auto">
									</div><br>
								</div>
							</div>
						</center>
					</div>
				</div>
			</section>
		</div>
		
		<script>
			var refresh_ms = 60000;
			var chart_range = "week";
		
			var wallet_network;
			var wallet_name;
			var wallet_address;
			var covalenthq_api_key;
		
			var cg_coins_data;
			var id_map = {};
		
			var sort_attrib = 'quote';
			var sort_dir = -1;
			var coins_data;
		
			var ignorelist_name;
			var ignorelist;
			var ignore_map;
			var add_hide_buttons = false;
			var show_ignored_coins = false;
		
			var balance_data;
			var balance_chart;
			var display_balance_div = false;
		
		
			if(localStorage.getItem(user + '-refresh_sec'))
				refresh_ms = 1000*localStorage.getItem(user + '-refresh_sec');
			else
				localStorage.setItem(user + '-refresh_sec', 60);
		
			if(localStorage.getItem(user + '-chart_range'))
				chart_range = localStorage.getItem(user + '-chart_range');
		
			if(localStorage.getItem(user + '-wallet'))
			{
				wallet_name = localStorage.getItem(user + '-wallet');
				wallet_network = localStorage.getItem(user + '-wallets-' + wallet_name + '-network');
				wallet_address = CryptoJS.AES.decrypt(localStorage.getItem(user + '-wallets-' + wallet_name + '-address'), CryptoJS.AES.decrypt(localStorage.getItem('password'), "Go hang a salami, I’m a lasagna hog.").toString(CryptoJS.enc.Utf8)).toString(CryptoJS.enc.Utf8);
			}
		
			if(localStorage.getItem(user + '-covalenthq_api_key'))
				covalenthq_api_key = CryptoJS.AES.decrypt(localStorage.getItem(user + '-covalenthq_api_key'), CryptoJS.AES.decrypt(localStorage.getItem('password'), "Go hang a salami, I’m a lasagna hog.").toString(CryptoJS.enc.Utf8)).toString(CryptoJS.enc.Utf8);
		
			function clear_chart_select()
			{
				var x = document.getElementById('chart_select');
				for(var i=x.options.length-1; i>0; i--)
					x.remove(i);
			}
		
			function clear_table()
			{
				var table = document.getElementById("wallet_table");
		
				var no_rows = table.rows.length-2;
				for(var i=0; i < no_rows; i++)
					table.deleteRow(1);	
		
				clear_chart_select();
			}
		
			function draw_table()
			{
				clear_table();
				var table = document.getElementById("wallet_table");
				var wallet_balance = 0.0;
		
				ignore_map = fetch_ignorelist_map(user, wallet_name);
		
				document.getElementById('loading_gif').src = "";
				document.getElementById('loading_gif').style.visibility = "hidden";
				document.getElementById('loading_gif').style.display = "none";
				document.getElementById("wallet_table").style.display = "inline";
		
				if(coins_data['data']['items'].length > 0)
				{
					var coins_str = "";
		
					for(var i=0, r=0; i<coins_data['data']['items'].length; i++)
					{
						if(coins_data['data']['items'][i]['contract_ticker_symbol'] != undefined &&
							coins_data['data']['items'][i]['contract_name'] != undefined &&
							(show_ignored_coins ||
								(coins_data['data']['items'][i]['quote'] > 0 &&
								ignore_map[coins_data['data']['items'][i]['contract_ticker_symbol'].toLowerCase().replace(/ /g, "").replace(/-/g, "")] != true &&
							    ignore_map[coins_data['data']['items'][i]['contract_name'].toLowerCase().replace(/ /g, "").replace(/-/g, "")] != true &&
							    ignore_map[id_map[coins_data['data']['items'][i]['contract_name'].replace(/ /g, "").replace(/-/g, "").toLowerCase()]] != true)))
						{
							coins_data['data']['items'][i]['contract_ticker_symbol'] = coins_data['data']['items'][i]['contract_ticker_symbol'].toLowerCase();
		
							var row = table.insertRow(r+1);
							r++;
							if(coins_data['data']['items'][i]['logo_url'] != "")
								row.insertCell(0).innerHTML = "<img style='min-width; 23px; max-height: 23px; vertical-align:middle' class='rounded' onerror='this.style.display=\"none\"' src='" + coins_data['data']['items'][i]['logo_url'] + "'>";
		
							row.insertCell(1).innerHTML = coins_data['data']['items'][i]['contract_ticker_symbol'];
		
							if(id_map[coins_data['data']['items'][i]['contract_name'].replace(/ /g, "").replace(/-/g, "").toLowerCase()] != undefined)
							{
								row.insertCell(2).innerHTML = "<a href='coin.html?id=" + id_map[coins_data['data']['items'][i]['contract_name'].replace(/ /g, "").replace(/-/g, "").toLowerCase()] + "'>" + coins_data['data']['items'][i]['contract_name'] + "</a>";
								if(coins_str.length > 0)
									coins_str += ",";
								coins_str += id_map[coins_data['data']['items'][i]['contract_name'].replace(/ /g, "").replace(/-/g, "").toLowerCase()];
		
								var option = document.createElement("option");
								option.text = coins_data['data']['items'][i]['contract_name'];
								option.value = coins_data['data']['items'][i]['contract_address'];
								document.getElementById('chart_select').add(option);
							}
							else if(id_map[coins_data['data']['items'][i]['contract_ticker_symbol']] != undefined)
							{
								row.insertCell(2).innerHTML = "<a href='coin.html?id=" + id_map[coins_data['data']['items'][i]['contract_ticker_symbol']] + "'>" + coins_data['data']['items'][i]['contract_name'] + "</a>";
								if(coins_str.length > 0)
									coins_str += ",";
								coins_str += id_map[coins_data['data']['items'][i]['contract_ticker_symbol'].replace(/ /g, "").replace(/-/g, "").toLowerCase()];
		
								var option = document.createElement("option");
								option.text = coins_data['data']['items'][i]['contract_name'];
								option.value = coins_data['data']['items'][i]['contract_address'];
								document.getElementById('chart_select').add(option);
							}
							else
								row.insertCell(2).innerHTML = coins_data['data']['items'][i]['contract_name'];
		
							if(coins_data['data']['items'][i]['quote_rate'] != undefined)
							{
								if(coins_data['data']['items'][i]['quote_rate'] == 0)
									row.insertCell(3).innerHTML = "-";
								else if(coins_data['data']['items'][i]['quote_rate'] > 1)
									row.insertCell(3).innerHTML = "$" + parseFloat(coins_data['data']['items'][i]['quote_rate']).toLocaleString('en');
								else if(coins_data['data']['items'][i]['quote_rate'] > 0 && coins_data['data']['items'][i]['quote_rate'] < 0.0001)
									row.insertCell(3).innerHTML = "$" + parseFloat(coins_data['data']['items'][i]['quote_rate']).toExponential(3);
								else
									row.insertCell(3).innerHTML = "$" + coins_data['data']['items'][i]['quote_rate'].toFixed(6);
							}
							else
								row.insertCell(3).innerHTML = "-";
		
							if(coins_data['data']['items'][i]['quote'] > 0)
								row.insertCell(4).innerHTML = coins_data['data']['items'][i]['balance'].toLocaleString('en');
							else
								row.insertCell(4).innerHTML = "-";
		
							row.insertCell(5).innerHTML = "$" + coins_data['data']['items'][i]['quote'].toLocaleString('en');
		
							if(add_hide_buttons)
							{
								if(ignore_map[coins_data['data']['items'][i]['contract_name'].toLowerCase().replace(/ /g, "").replace(/-/g, "")] != true &&
						   			ignore_map[id_map[coins_data['data']['items'][i]['contract_name'].replace(/ /g, "").replace(/-/g, "").toLowerCase()]] != true)
								{
									if(coins_data['data']['items'][i]['quote'] > 0)
										row.insertCell(6).innerHTML = "<a onclick='ignore_coin(\"" + row.cells[2].innerText.replace(/ /g, "").replace(/-/g, "").toLowerCase() + "\")'><i class='fas fa-trash fa-1x' style='vertical-align:middle'></i></a>";
								}
								else if(show_ignored_coins)
									row.insertCell(6).innerHTML = "<a onclick='unignore_coin(\"" + row.cells[2].innerText.replace(/ /g, "").replace(/-/g, "").toLowerCase() + "\")'><i class='fas fa-trash-restore fa-1x' style='vertical-align:middle'></i></a>";
							}
		
							wallet_balance += coins_data['data']['items'][i]['quote'];
						}
					}
		
					document.getElementById('table_spotlight').style.width = (document.getElementById('wallet_table').offsetWidth + 70) + "px";
		
					document.getElementById("balance_div").innerHTML = "<b>balance:</b> $" + wallet_balance.toLocaleString();
					document.getElementById('balance_spotlight').style.width = (document.getElementById('balance_div').offsetWidth + 70) + "px";
		
					document.getElementById('charts_link').href = "charts.html?width=250&height=350&range=" + chart_range + "&coins=" + coins_str;
					document.getElementById('charts_link').style.display = "block";
				}
			}
		
			function sort_data()
			{
				if(sort_attrib == "contract_ticker_symbol" || sort_attrib == "contract_name")
				{
					coins_data['data']['items'].sort(function(obj1, obj2) {
						if(obj1[sort_attrib] == undefined)
						{
							if(obj2[sort_attrib] == undefined)
								return 0;
							else
								return sort_dir*1;
						}
						else if(obj2[sort_attrib] == undefined)
							return sort_dir*1;
		
						if(obj1[sort_attrib].toLowerCase() > obj2[sort_attrib].toLowerCase())
							return sort_dir*1;
						else if(obj1[sort_attrib] == obj2[sort_attrib])
							return 0;
						else return sort_dir*-1;
					});
				}
				else
				{
					coins_data['data']['items'].sort(function(obj1, obj2) {
						return sort_dir*(obj1[sort_attrib] - obj2[sort_attrib]);
					});
				}
		
				draw_table();
			}
		
			function toggle_sort(attrib)
			{
				if(sort_attrib == attrib)
					sort_dir *= -1;
				else
				{
					sort_attrib = attrib;
					sort_dir = -1;
				}
		
				sort_data();
			}
		
			function fetch_table_covalenthq()
			{
				$(document).ready(function(){
					$.get(
						'https://api.covalenthq.com/v1/' + wallet_network + '/address/' + wallet_address + '/balances_v2/?key=' + covalenthq_api_key,          
						function(data) {
							coins_data = data;
		
							for(var i=0; i<coins_data['data']['items'].length; i++)
								if(coins_data['data']['items'][i]['quote_rate'] > 0)
									coins_data['data']['items'][i]['balance'] = coins_data['data']['items'][i]['quote']/coins_data['data']['items'][i]['quote_rate'];
		
							if(sort_attrib == "quote" && sort_dir == -1)
								draw_table();
							else
								sort_data();
					});
				}).fail(function() {
					clear_table();
					document.getElementById('loading_gif').src = "";
					document.getElementById('loading_gif').style.visibility = "hidden";
					document.getElementById('loading_gif').style.display = "none";
					document.getElementById("balance_spotlight").style.display = "none";
					document.getElementById('show_ignored_coins_button').style.display = "none";
					document.getElementById("table_spotlight").style.width = "600px";
		
		
					document.getElementById("table_div").innerHTML = "<p style='margin-top: 20px; margin-bottom: 10px'>failed to fetch wallet information, please refresh to try again.</p>";
				});
			}
		
			function refresh_table()
			{
				if(refresh_ms > 0)
					sleep(refresh_ms).then(() => { fetch_table_covalenthq(); refresh_table(); });
			}
		
			function setup_id_map()
			{
				for(var i=0; i<cg_coins_data.length; i++)
				{
					id_map[cg_coins_data[i]['id'].replace(/ /g, "").replace(/-/g, "").toLowerCase().toLowerCase()] = cg_coins_data[i]['id'];
					id_map[cg_coins_data[i]['name'].replace(/ /g, "").replace(/-/g, "").toLowerCase().toLowerCase()] = cg_coins_data[i]['id'];
					id_map[cg_coins_data[i]['symbol'].toLowerCase()] = cg_coins_data[i]['id'];
				}
			}
		
			function fetch_coins_list()
			{
				$(document).ready(function(){
					$.get(
			    	    'https://api.coingecko.com/api/v3/coins/list',              
						function(data) {
							cg_coins_data = data;
							setup_id_map();
		
							fetch_table_covalenthq();
							refresh_table();
					}).fail(function() {
						clear_table();
						document.getElementById('loading_gif').src = "";
						document.getElementById('loading_gif').style.visibility = "hidden";
						document.getElementById('loading_gif').style.display = "none";
						document.getElementById("balance_spotlight").style.display = "none";
						document.getElementById('show_ignored_coins_button').style.display = "none";
						document.getElementById("table_spotlight").style.width = "600px";
		
		
						document.getElementById("table_div").innerHTML = "<p style='margin-top: 20px; margin-bottom: 10px'>failed to fetch coins list, please refresh to try again.</p>";
					});
				});
			}
		
			function setup_wallet_select()
			{
				var x = document.getElementById('wallet_select');
				for(var i=x.options.length-1; i>=0; i--)
					x.remove(i);
		
				var wallets = fetch_wallets(user);
		
				if(wallets.length > 1)
				{
					for(var i=1; i<wallets.length; i++)
					{
						var option = document.createElement("option");
						option.text = wallets[i];
						x.add(option);
					}
		
					if(localStorage.getItem(user + "-wallet"))
						document.getElementById('wallet_select').value = localStorage.getItem(user + "-wallet");
					
					wallet_name = document.getElementById('wallet_select').value;
					wallet_network = localStorage.getItem(user + '-wallets-' + wallet_name + "-network");
					wallet_address = CryptoJS.AES.decrypt(localStorage.getItem(user + '-wallets-' + wallet_name + "-address"), CryptoJS.AES.decrypt(localStorage.getItem('password'), "Go hang a salami, I’m a lasagna hog.").toString(CryptoJS.enc.Utf8)).toString(CryptoJS.enc.Utf8);
				}
				else
				{
					document.getElementById('wallet_select').style.display = "none";
					document.getElementById('balance_spotlight').style.display = "none";
					document.getElementById('table_spotlight').style.display = "none";
					document.getElementById('show_ignored_coins_button').style.display = "none";
					document.getElementById('no_wallets_spotlight').style.display = "block";
					document.getElementById('no_wallets_spotlight').innerHTML = user + " does not have any wallets";
				}
			}
		
			function wallet_select_event()
			{
				wallet_name = document.getElementById('wallet_select').value;
				wallet_network = localStorage.getItem(user + '-wallets-' + wallet_name + '-network');
				wallet_address = CryptoJS.AES.decrypt(localStorage.getItem(user + '-wallets-' + wallet_name + '-address'), CryptoJS.AES.decrypt(localStorage.getItem('password'), "Go hang a salami, I’m a lasagna hog.").toString(CryptoJS.enc.Utf8)).toString(CryptoJS.enc.Utf8);
				localStorage.setItem(user + "-wallet", wallet_name);
				fetch_table_covalenthq();
			}
		
			function ignore_coin(id)
			{
				ignorelist = fetch_ignorelist(user, wallet_name);
				ignore(user, ignorelist, wallet_name, id);
				draw_table();
			}
		
			function unignore_coin(id)
			{
				ignorelist = fetch_ignorelist(user, wallet_name);
				unignore(user, ignorelist, wallet_name, id);
				draw_table();
			}
		
			function toggle_hide_coins()
			{
				var table = document.getElementById('wallet_table');
				var no_rows = table.rows.length - 1;
		
				if(add_hide_buttons)
				{
					add_hide_buttons = false;
		
					for(var r=1; r<no_rows; r++)
						table.rows[r].deleteCell(6);
				}
				else
				{
					add_hide_buttons = true;
		
					for(var r=1; r<document.getElementById('wallet_table').rows.length-1; r++)
					{
						var coin_name = document.getElementById('wallet_table').rows[r].cells[2].innerText.toLowerCase().replace(/ /g, "").replace(/-/g, "");
						if(ignore_map[coin_name] != true &&
						   	ignore_map[coin_name] != true)
						{
							if(table.rows[r].cells[4].innerText != '-')
							{
								table.rows[r].insertCell(6).innerHTML = "<a onclick='ignore_coin(\"" + table.rows[r].cells[2].innerText.replace(/ /g, "").replace(/-/g, "").toLowerCase() + "\")'><i class='fas fa-trash fa-1x' style='vertical-align:middle'></i></a>";
							}
						}
						else if(show_ignored_coins)
						{
							table.rows[r].insertCell(6).innerHTML = "<a onclick='unignore_coin(\"" + table.rows[r].cells[2].innerText.replace(/ /g, "").replace(/-/g, "").toLowerCase() + "\")'><i class='fas fa-trash-restore fa-1x' style='vertical-align:middle'></i></a>";
						}
					}
				}
			}
		
			function toggle_show_ignored_coins()
			{
				if(show_ignored_coins)
				{
					show_ignored_coins = false;
					document.getElementById('show_ignored_coins_button').innerHTML = "show ignored coins";
				}
				else
				{
					show_ignored_coins = true;
					document.getElementById('show_ignored_coins_button').innerHTML = "hide ignored coins";
				}
		
				draw_table();
			}
		
			function draw_chart(title, data)
			{
				var options = {
			      series: [{
			      name: 'date',
			      data: data
			    }],
			      chart: {
			      type: 'area',
			      stacked: false,
			      background: 'none',
			      height: 350,
			      zoom: {
			        type: 'xy',
			        enabled: true,
			      },
			      toolbar: {
			        autoSelected: 'zoom'
			      }
			    },
			    colors:['#C600EB', '#E91E63', '#9C27B0'],
			    dataLabels: {
			      enabled: false
			    },
			    markers: {
			      size: 0,
			    },
			    title: {
			      text: title,
			      align: 'left',
			      textColor: '#ff1493',
			    },
			    fill: {
			      type: 'gradient',
			      gradient: {
			        shadeIntensity: 0.4,
			        inverseColors: false,
			        opacityFrom: 0.8,
			        opacityTo: 0.4,
			        stops: [0, 90, 100]
			      },
			    },
			    yaxis: {
			      labels: {
			        formatter: function (val) {
			          var abs_val = Math.abs(val);
			          if(val == 0)
			          	return 0;
			          else if(abs_val >= 1)
			          	return val.toLocaleString('en');
			          else if(abs_val > 0 && abs_val < 0.001)
			          	return val.toExponential(3);
			          else
			          	return val.toFixed(5);
			        },
			      },
			      tickAmount: 4,
			      title: {
			        text: "value",
			      },
			    },
			    xaxis: {
			      type: 'datetime',
		          tickAmount: 5,
			      labels: {
			        formatter: function (val) {
			          return new Date(val).toLocaleDateString();
			        },
			      },
			    },
			    theme: {
			    	mode: 'dark',
			    },
			    stroke: {
				    width: 2,    
				},
			    tooltip: {
			      shared: false,
			      y: {
			        formatter: function (val) {
			          return (val / 1000000).toFixed(0);
			        }
			      }
			    }
			    };
		
			    balance_chart = new ApexCharts(document.querySelector("#balance_chart"), options);
			    balance_chart.render();
			}
		
			function fetch_balance_data()
			{
				$(document).ready(function(){
					//alert('https://api.covalenthq.com/v1/' + wallet_network + '/address/' + wallet_address + '/portfolio_v2/?key=' + covalenthq_api_key);
					$.get(
						'https://api.covalenthq.com/v1/' + wallet_network + '/address/' + wallet_address + '/portfolio_v2/?key=' + covalenthq_api_key,
						function(data) {
							balance_data = data;
							document.getElementById('balance_chart_div').style.display = "block";
					}).fail(function() {
						document.getElementById('balance_chart_div').style.display = "none";
						alert("could not find balance chart for " + document.getElementById('chart_select').text);
					});
				});
			}
		
			function fetch_chart()
			{
				var coin_address = document.getElementById('chart_select').value;
				var chart_data = [];
		
				if(balance_chart != undefined)
				{
					balance_chart.destroy();
					document.getElementById('balance_chart').innerHTML = "";
				}
		
				for(var i=0; i<balance_data['items'].length; i++)
				{
					if(balance_data['items'][i]['contract_address'] == coin_address)
					{
						for(var j=0; j<balance_data['items'][i]['holdings'].length; j++)
							if(balance_data['items'][i]['holdings'][j]['close']['quote'] != undefined)
								chart_data[j] = [balance_data['items'][i]['holdings'][j]['timestamp'], balance_data['items'][i]['holdings'][j]['close']['quote']];
		
						draw_chart(balance_data['items'][i]['contract_name'], chart_data);
						break;
					}
				}
		
				document.getElementById('balance_chart_spotlight').style.display = "block";
				document.getElementById('balance_chart_spotlight').style.height = (document.getElementById('balance_chart').offsetHeight + 10) + "px";
			}
		
			document.getElementById('table_spotlight').style.width = (document.getElementById('loading_gif').offsetWidth + 400) + "px";
			document.getElementById("table_div").scrollIntoView();
		
			if(localStorage.getItem(user + "-wallets"))
			{
				setup_wallet_select();
				document.getElementById('table_spotlight').style.width = (document.getElementById('loading_gif').offsetWidth + 400) + "px";
				document.getElementById("table_div").scrollIntoView();
				fetch_coins_list();
				fetch_balance_data();
			}
			else
			{
				clear_table();
				document.getElementById('loading_gif').src = "";
				document.getElementById('loading_gif').style.visibility = "hidden";
				document.getElementById('loading_gif').style.display = "none";
				document.getElementById("wallet_select").style.display = "none";
				document.getElementById("balance_spotlight").style.display = "none";
				document.getElementById('show_ignored_coins_button').style.display = "none";
				document.getElementById("table_spotlight").style.width = "600px";
		
				if(localStorage.getItem("username"))
					document.getElementById("table_div").innerHTML = "<p style='margin-top: 20px; margin-bottom: 20px'>Please <a href='config.html'>configure</a> your wallet address and CovalentHQ api key.</p><p style='margin-bottom: 10px'><b>Note:</b> You will need to register an account with <a href='https://covalenthq.com/'>CovalentHQ</a> to obtain a free API key</p>";
				else
					document.getElementById("table_div").innerHTML = "<p style='margin-top: 20px; margin-bottom: 20px'>Please login to access the wallet tracker</p><p style='margin-bottom: 10px'><a href='login.html?return_to=wallet.html'><i class='fas fa-sign-in-alt fa-2x' style='margin-bottom: 10px'></i></a></p>";
			}
		</script>

		<!-- Footer -->
		<div class="footer wrapper">
			<div class="inner" style="text-align:center">
				<noselect>
					<p>
						<a href="search.html" title='search'><i class="fas fa-search fa-2x"></i></a> &nbsp;
						<a href="coins.html" title='coins'><i class="fas fa-coins fa-2x"></i></a> &nbsp;
						<a href="charts.html" title='charts'><i class="fas fa-chart-area fa-2x"></i></a> &nbsp;
						<a href="scams.html" title='scams'><i class="fas fa-bomb fa-2x"></i></a> &nbsp;
						<a href="watchlist.html" title='watchlist'><i class="fas fa-binoculars fa-2x"></i></a> &nbsp;
						<a href="wallet.html" title='wallet tracker'><i class="fas fa-wallet fa-2x"></i></a><br>
						
						<a href="https://t.me/dexata_army" title='telegram'><i class="icon brands fa-telegram fa-2x"></i></a> &nbsp;
						<a href="https://twitter.com/dexata_army" title='twitter'><i class="icon brands fa-twitter fa-2x"></i></a> &nbsp;
						<a href="https://github.com/dexata-army" title='github'><i class="icon brands fa-github fa-2x"></i></a> &nbsp;
						<a href="config.html" title='config'><i class="fas fa-cogs fa-2x"></i></a> &nbsp;
						<a href="manage_users.html" title='manage users'><i class="fas fa-user-cog fa-2x"></i></a> &nbsp;
						<text id="login_footer_item" style="display: inline-block"><a href="login.html" title='login'><i class="fas fa-sign-in-alt fa-2x"></i></a></text>
					</p>
		
					<p>
						<input id="footer_search_box" placeholder="search">
					</p>
		
					<p class="copyright">
						&copy;<script>document.write(new Date().getFullYear())</script> Dexata
					</p>
				</noselect>
			</div>
		</div>
		
		<script>
			window.addEventListener('keydown',this.keydown,false);
		
			function keydown(e)
			{
				var code = e.keyCode;
				
				if(document.activeElement.tagName == "INPUT")
				{
					if(code == 13)
					{
						if(document.activeElement.id == "footer_search_box" &&
							document.getElementById('footer_search_box').value != "")
						{
							window.location.href = "search.html?term=" + document.getElementById('footer_search_box').value;
						}
					}
				}
			}
		</script>

		<script>
			//changes login to logout on page if logged in
			if(localStorage.getItem("username"))
			{
				//document.getElementById('login_menu_item').innerHTML = "<a onclick='logout()'>logout</a>";
				//document.getElementById('login_footer_item').innerHTML = "<a onclick='logout()' title='logout'><i class='fas fa-sign-out-alt fa-2x'></i></a>";
				document.getElementById('login_menu_item').innerHTML = "<a href='logout.html?return_to=" + window.location.href.substring(window.location.href.lastIndexOf('/') + 1) + "'>logout</a>"
				document.getElementById('login_footer_item').innerHTML = "<a href='logout.html?return_to=" + window.location.href.substring(window.location.href.lastIndexOf('/') + 1) + "'><i class='fas fa-sign-out-alt fa-2x'></i></a>"
			}
			else
			{
				document.getElementById('login_menu_item').innerHTML = "<a href='login.html?return_to=" + window.location.href.substring(window.location.href.lastIndexOf('/') + 1) + "'>login</a>"
				document.getElementById('login_footer_item').innerHTML = "<a href='login.html?return_to=" + window.location.href.substring(window.location.href.lastIndexOf('/') + 1) + "'><i class='fas fa-sign-in-alt fa-2x'></i></a>"
			}
		
			//prevent autocomplete
			$(':input').on('focus', function () {
				$(this).attr('autocomplete', 'off')
			});
		</script>

		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>
	</body>
</html>
